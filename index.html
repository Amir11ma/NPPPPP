<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FarsiGPT</title>

<style>
body{
    margin:0;
    font-family:'Shabnam',sans-serif;
    background:#f2f2f2;
}

/* ØµÙØ­Ù‡ Ù„ÙˆØ¯ */
#loader{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:#0a3d62;
    display:flex;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    color:white;
    font-size:18px;
    z-index:9999;
}
.spinner{
    border:6px solid #f3f3f3;
    border-top:6px solid #fff;
    border-radius:50%;
    width:50px;
    height:50px;
    animation:spin 1s linear infinite;
    margin-bottom:15px;
}
@keyframes spin{
    0%{transform:rotate(0deg);}
    100%{transform:rotate(360deg);}
}

/* Ù‡Ø¯Ø± */
header{
    background:#0a3d62;
    color:white;
    padding:12px;
    text-align:center;
}
header small{
    font-size:12px;
    opacity:.9;
}

/* Ú†Øª */
#chat{
    padding:12px;
    height:calc(100vh - 120px); /* Ø¨Ø§Ù„Ø§ØªØ± Ø¨Ø±Ø¯Ù† Ø¨Ø§Ú©Ø³ Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… */
    overflow-y:auto;
}
.bubble{
    max-width:85%;
    padding:10px 14px;
    margin-bottom:10px;
    border-radius:12px;
    line-height:1.8;
    white-space:pre-wrap;
}
.user{
    background:#d1f2eb;
    margin-left:auto;
}
.bot{
    background:#ffffff;
    margin-right:auto;
}

/* Ø¨Ø§Ú©Ø³ ÙˆØ±ÙˆØ¯ÛŒ */
#inputBox{
    display:flex;
    padding:10px;
    background:white;
    border-top:1px solid #ccc;
    position: fixed;
    bottom:0;
    width:100%;
}
input{
    flex:1;
    padding:10px;
    font-size:15px;
    border:none;
    outline:none;
}
button{
    padding:10px 16px;
    background:#0a3d62;
    color:white;
    border:none;
    cursor:pointer;
}
</style>

<!-- ÙÙˆÙ†Øª Shabnam -->
<link href="https://cdn.jsdelivr.net/gh/rastikerdar/shabnam-font@3.0.1/dist/font-face.css" rel="stylesheet" type="text/css">

</head>
<body>

<!-- ØµÙØ­Ù‡ Ù„ÙˆØ¯ -->
<div id="loader">
    <div class="spinner"></div>
    Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ FarsiGPT...
</div>

<header>
    <strong>FarsiGPT</strong>
    <small>Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· BGM STUDIO ğŸ‡®ğŸ‡·</small>
</header>

<div id="chat"></div>

<div id="inputBox">
    <input id="userInput" placeholder="Ù¾ÛŒØ§Ù…Øª Ø±Ùˆ Ø¨Ù†ÙˆÛŒØ³...">
    <button onclick="send()">Ø§Ø±Ø³Ø§Ù„</button>
</div>

<script>
const API = "https://gpt4.api-sina-free.workers.dev/gpt4?text=";
let memory = [];
const systemPrompt = "ØªÙˆ FarsiGPT Ù‡Ø³ØªÛŒØŒ Ø¯Ø³ØªÛŒØ§Ø± ÙØ§Ø±Ø³ÛŒØŒ Ù…Ø­ØªØ±Ù…Ø§Ù†Ù‡ Ùˆ Ù‡Ù…Ø³Ùˆ Ø¨Ø§ ÙØ±Ù‡Ù†Ú¯ Ø§ÛŒØ±Ø§Ù†ÛŒ Ùˆ Ø§Ø³Ù„Ø§Ù…ÛŒ. Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ Ú©Ø§Ù…Ù„ Ø¨Ø§Ø´Ù†Ø¯.";

function addBubble(text,type){
    const d=document.createElement("div");
    d.className="bubble "+type;
    d.innerText=text;
    chat.appendChild(d);
    chat.scrollTop=99999;
}

function identityAnswer(text){
    const t=text.replace(/\s/g,"");
    if(
        t.includes("Ø§Ø³Ù…ØªÚ†ÛŒÙ‡") ||
        t.includes("ØªÙˆÚ©ÛŒÙ‡Ø³ØªÛŒ") ||
        t.includes("Ø³Ø§Ø²Ù†Ø¯Ù‡") ||
        t.includes("Ú©ÛŒØ³Ø§Ø®ØªØª")
    ){
        return "Ù…Ù† FarsiGPT Ù‡Ø³ØªÙ… ğŸ¤–\nØ³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· BGM STUDIO ğŸ‡®ğŸ‡·\nØ¨Ø±Ø§ÛŒ Ù¾Ø§Ø³Ø®â€ŒÚ¯ÙˆÛŒÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ù‡ Ø³ÙˆØ§Ù„Ø§Øª ÙØ§Ø±Ø³ÛŒ.";
    }
    return null;
}

async function send(){
    const input=document.getElementById("userInput");
    const text=input.value.trim();
    if(!text) return;

    addBubble(text,"user");
    input.value="";

    const fixed = identityAnswer(text);
    if(fixed){
        addBubble(fixed,"bot");
        return;
    }

    addBubble("Ø¯Ø± Ø­Ø§Ù„ ÙÚ©Ø± Ú©Ø±Ø¯Ù†...","bot");

    memory.push("Ú©Ø§Ø±Ø¨Ø±: "+text);
    if(memory.length>10) memory.shift();

    const prompt =
        systemPrompt +
        "\n\nØ³Ø§Ø¨Ù‚Ù‡ Ù…Ú©Ø§Ù„Ù…Ù‡:\n" +
        memory.join("\n") +
        "\n\nÙ¾Ø§Ø³Ø® Ø¨Ø¯Ù‡:";

    try{
        const res=await fetch(API+encodeURIComponent(prompt));
        const data=await res.json();

        document.querySelectorAll(".bot").forEach(b=>{
            if(b.innerText==="Ø¯Ø± Ø­Ø§Ù„ ÙÚ©Ø± Ú©Ø±Ø¯Ù†...") b.remove();
        });

        const answer=data.result || "Ù¾Ø§Ø³Ø®ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯.";
        addBubble(answer,"bot");

        memory.push("Ø±Ø¨Ø§Øª: "+answer);
        if(memory.length>10) memory.shift();

    }catch{
        addBubble("âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±.","bot");
    }
}

// Ù¾ÛŒØ§Ù… Ø´Ø±ÙˆØ¹
addBubble(
"Ø³Ù„Ø§Ù… ğŸ‘‹\nÙ…Ù† FarsiGPT Ù‡Ø³ØªÙ….\nÙ‡Ø± Ø³ÙˆØ§Ù„ÛŒ Ø¯Ø§Ø±ÛŒ Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ Ø¨Ù¾Ø±Ø³.",
"bot"
);

// Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† ØµÙØ­Ù‡ Ù„ÙˆØ¯ Ø¨Ø¹Ø¯ 1.5 Ø«Ø§Ù†ÛŒÙ‡
window.addEventListener("load",()=>{
    setTimeout(()=>document.getElementById("loader").style.display="none",1500);
});
</script>

</body>
</html>
